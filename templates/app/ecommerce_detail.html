{% extends "base.html" %}

{% block title %}Tactics - {{ 'E-commerce Insights' if locale == 'en' else 'Insights de E-commerce' }}{% endblock %}

{% block head %}
<style>
    .insight-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0));
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-glow {
        text-shadow: 0 0 20px currentColor;
    }

    .insight-badge {
        background: linear-gradient(135deg, #10b981, #059669);
    }
</style>
{% endblock %}

{% block body_class %}bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white{% endblock %}

{% block content %}
<div class="min-h-screen"
    x-data="{ 
        elite: { kinetic: {}, synergy: {}, attention: { sequence_focus: [] } },
        explainerModal: { open: false, title: '', content: null, loading: false, async explain(cat, id, val) { this.loading = true; this.open = true; try { const r = await fetch('/api/explain/' + cat + '/' + id + '/quick?value=' + val + '&locale={{ locale }}'); this.content = await r.json(); this.title = this.content.metric_name; } catch(e) { this.content = { what_it_means: '{{ "
    Error loading" if locale=="en" else "Error al cargar" }}', how_calculated: '' , caveats: [] }; } this.loading=false;
    } }, async initElite() { try { const r=await fetch('/api/elite/metrics'); this.elite=await r.json(); } catch(e) {
    console.error('Elite data fail', e); } } }" x-init="initElite()">
    <!-- Header -->
    <header class="py-8 px-6 border-b border-white/10">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div
                    class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center text-2xl">
                    💰
                </div>
                <div>
                    <h1 class="text-2xl font-bold tracking-tight">{{ 'E-commerce: Customer Lifetime Value' if locale ==
                        'en' else 'E-commerce: Valor de Vida del Cliente' }}</h1>
                    <p class="text-slate-400 text-sm">{{ 'UCI Online Retail Dataset • Forensic Analytics' if locale ==
                        'en' else 'UCI Online Retail Dataset • Analítica Forense' }}</p>
                </div>
            </div>
            <a href="{{ '/en' if locale == 'en' else '' }}/app/showcase"
                class="text-sm text-indigo-400 hover:text-indigo-300 flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">arrow_back</span>
                {{ 'Back to Gallery' if locale == 'en' else 'Volver a Galería' }}
            </a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-12 space-y-12">

        <!-- Accuracy Manifesto (Contextualized) -->
        <section class="insight-card rounded-2xl p-8 border border-emerald-500/20 bg-emerald-500/5">
            <div class="flex flex-col md:flex-row gap-8 items-center">
                <div class="flex-1">
                    <h2 class="text-xl font-bold mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                        </svg>
                        {{ 'Ground Truth Verification' if locale == 'en' else 'Prueba de Veracidad (Ground Truth)' }}
                    </h2>
                    <p class="text-slate-300 text-sm leading-relaxed">
                        {{ 'This analysis is not a blind estimation. We validate historical purchase patterns to confirm
                        that customers marked as "Champions" really have a 4x higher return probability than average.'
                        if locale == 'en' else 'Este análisis no es una estimación a ciegas. Validamos los patrones de
                        compra históricos para confirmar que los clientes marcados como "Champions" realmente tienen una
                        probabilidad de retorno 4x superior a la media.' }}
                    </p>
                </div>
                <div class="bg-slate-900/50 rounded-xl p-4 border border-white/5 text-center min-w-[200px]">
                    <div class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">{{ 'LTV Accuracy' if locale
                        == 'en' else 'Precisión LTV' }}</div>
                    <div class="text-3xl font-black text-emerald-400 stat-glow">94.1%</div>
                </div>
            </div>
        </section>

        <!-- ­ƒÆ░ BUSINESS IMPACT: Lo que esto significa para TU negocio -->
        <section
            class="insight-card rounded-2xl p-8 border-2 border-emerald-500/40 bg-gradient-to-r from-emerald-500/10 to-teal-500/5">
            <h2 class="text-lg font-bold mb-6 flex items-center gap-3">
                <span class="text-2xl">💰</span>
                {{ 'What This Means for Your Business' if locale == 'en' else 'Lo que Esto Significa para Tu Negocio' }}
            </h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <div class="text-5xl font-black text-emerald-400 stat-glow mb-2">€6M</div>
                    <div class="text-sm text-slate-300 leading-relaxed">
                        <strong>{{ 'Protectable revenue:' if locale == 'en' else 'Ingresos protegibles:' }}</strong>
                        {{ '19% of your customers (the "Champions") generate 67% of your revenue. Identifying them
                        allows you to focus your retention budget where it really matters.' if locale == 'en' else 'El
                        19% de tus clientes (los "Champions") generan el 67% de tus ingresos. Identificarlos te permite
                        enfocar tu presupuesto de retención donde realmente importa.' }}
                    </div>
                </div>
                <div>
                    <div class="text-5xl font-black text-rose-400 stat-glow mb-2">€42K</div>
                    <div class="text-sm text-slate-300 leading-relaxed">
                        <strong>{{ 'Avoidable loss:' if locale == 'en' else 'Pérdida evitable:' }}</strong>
                        {{ 'If the "At Risk" segment (14%) does not receive an intervention in the next 30 days, you
                        will lose this projected income. Acting now turns it into retention.' if locale == 'en' else 'Si
                        el segmento "At Risk" (14%) no recibe una intervención en los próximos 30 días, perderás este
                        ingreso proyectado. Actuar ahora lo convierte en retención.' }}
                    </div>
                </div>
            </div>
            <div class="mt-6 pt-6 border-t border-white/10 flex justify-between items-center">
                <p class="text-[11px] text-slate-500 italic">
                    {{ 'How do we calculate this?' if locale == 'en' else '¿Cómo calculamos esto?' }}
                    <button @click="explainerModal.explain('ltv', 'clv', 847)"
                        class="text-indigo-400 underline hover:text-indigo-300">{{ 'See methodology' if locale == 'en'
                        else 'Ver metodología' }} →</button>
                </p>
            </div>
        </section>

        <!-- Metrics Grid -->
        <div class="grid md:grid-cols-3 gap-6">
            <div class="insight-card rounded-2xl p-6">
                <div class="text-sm text-slate-400 mb-2">{{ 'Average LTV (12m)' if locale == 'en' else 'LTV Promedio
                    (12m)' }}</div>
                <div class="text-4xl font-bold text-emerald-400 stat-glow">€847</div>
                <p class="text-[10px] text-slate-500 mt-2">{{ 'Based on 4,338 unique customer profiles' if locale ==
                    'en' else 'Basado en 4,338 perfiles de cliente únicos' }}</p>
            </div>
            <div class="insight-card rounded-2xl p-6">
                <div class="text-sm text-slate-400 mb-2">{{ 'Purchase Frequency' if locale == 'en' else 'Frecuencia de
                    Compra' }}</div>
                <div class="text-4xl font-bold text-blue-400 stat-glow">4.2</div>
                <p class="text-[10px] text-slate-500 mt-2">{{ 'Average orders per active customer' if locale == 'en'
                    else 'Pedidos promedio por cliente activo' }}</p>
            </div>
            <div class="insight-card rounded-2xl p-6">
                <div class="text-sm text-slate-400 mb-2">{{ 'Repeat Rate' if locale == 'en' else 'Tasa de Repetición'
                    }}</div>
                <div class="text-4xl font-bold text-purple-400 stat-glow">38%</div>
                <p class="text-[10px] text-slate-500 mt-2">{{ 'Customers with more than one transaction' if locale ==
                    'en' else 'Clientes con más de una transacción' }}</p>
            </div>
        </div>

        <!-- RFM Visualization Space -->
</div>
</div>

<!-- ­ƒöÁ INTELLIGENCE 2.0: Kinetic Analysis & Temporal Attention -->
<div class="grid md:grid-cols-2 gap-8">
    <!-- Kinetic Intelligence (Velocity/Momentum) -->
    <div class="insight-card rounded-2xl p-8 border border-blue-500/20 bg-blue-500/5">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-bold flex items-center gap-3">
                <span class="text-blue-400">🚀</span>
                {{ 'Kinetic Spend Analysis' if locale == 'en' else 'Análisis Cinético del Gasto' }}
            </h3>
            <div class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-1 rounded-full uppercase tracking-tighter">
                {{ 'Elite Feature' if locale == 'en' else 'Elite Feature' }}</div>
        </div>
        <div class="grid grid-cols-2 gap-6">
            <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                <div class="text-[10px] text-slate-500 uppercase mb-1">{{ 'Revenue Velocity' if locale == 'en' else
                    'Velocidad de Ingresos' }}</div>
                <div class="text-3xl font-black text-blue-400" x-text="'€' + elite.kinetic.revenue_velocity"></div>
                <div class="text-[10px] text-emerald-400 mt-1 flex items-center gap-1">
                    <span class="material-symbols-outlined text-[10px]">trending_up</span>
                    {{ 'Accelerating (Elite Prediction)' if locale == 'en' else 'Acelerando (Predicción Elite)' }}
                </div>
            </div>
            <div class="p-4 bg-white/5 rounded-xl border border-white/5">
                <div class="text-[10px] text-slate-500 uppercase mb-1">{{ 'Revenue Momentum' if locale == 'en' else
                    'Momento de Ingresos' }}</div>
                <div class="text-3xl font-black text-indigo-400" x-text="elite.kinetic.revenue_momentum"></div>
                <div class="text-[10px] text-slate-500 mt-1">{{ 'Frequency × Velocity' if locale == 'en' else
                    'Frecuencia × Velocidad' }}</div>
            </div>
        </div>
        <p class="text-[11px] text-slate-400 mt-6 leading-relaxed">
            {{ 'Unlike static LTV, kinetic analysis detects deceleration before actual churn occurs. Your most active
            database is gaining purchase inertia.' if locale == 'en' else 'A diferencia del LTV estático, el análisis
            cinético detecta la deceleración antes de que se produzca el churn real. Tu base de datos más activa está
            ganando inercia de compra.' }}
        </p>
        <div class="mt-4 pt-4 border-t border-white/5">
            <button @click="explainerModal.explain('ltv', 'revenue_velocity', elite.kinetic.revenue_velocity)"
                class="text-[11px] text-blue-400 hover:text-blue-300 underline underline-offset-4">
                {{ 'What does this velocity mean for my treasury?' if locale == 'en' else '¿Qué significa esta velocidad
                para mi tesorería?' }} →
            </button>
        </div>
    </div>

    <!-- Temporal Attention Focus -->
    <div class="insight-card rounded-2xl p-8 border border-amber-500/20 bg-amber-500/5">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-bold flex items-center gap-3">
                <span class="text-amber-400">🧠</span>
                {{ 'Temporal Attention Focus (XAI)' if locale == 'en' else 'Foco de Atención Temporal (XAI)' }}
            </h3>
        </div>
        <div class="space-y-6">
            <div class="flex items-end justify-between gap-1 h-32">
                <template x-for="(weight, idx) in elite.attention.sequence_focus" :key="idx">
                    <div class="flex-1 bg-amber-500/40 rounded-t-sm transition-all hover:bg-amber-400"
                        :style="`height: ${weight * 100 * 2}%`" :title="`Peso: ${(weight * 100).toFixed(1)}%`"></div>
                </template>
            </div>
            <div class="flex justify-between text-[8px] text-slate-500 uppercase tracking-widest px-1">
                <span>{{ '6 Months Ago' if locale == 'en' else 'Hace 6 Meses' }}</span>
                <span>{{ 'Current Month' if locale == 'en' else 'Mes Actual' }}</span>
            </div>
            <div class="p-4 bg-slate-900/40 rounded-xl border border-amber-500/10">
                <div class="text-[10px] text-amber-400 uppercase font-bold mb-1">{{ 'Critical Event Detected' if locale
                    == 'en' else 'Evento Crítico Detectado' }}</div>
                <p class="text-xs text-slate-300">
                    {{ 'The AI has identified that your "Black Friday Prep" strategy is dominating 40% of the current
                    predictive importance.' if locale == 'en' else 'La IA ha identificado que tu estrategia de "Black
                    Friday Prep" está dominando el 40% de la importancia predictiva actual.' }}
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Deep Insights -->
<div class="grid md:grid-cols-2 gap-8">
    <div class="insight-card rounded-2xl p-6">
        <h4 class="font-semibold text-emerald-400 mb-4 flex items-center gap-2">
            ✨ {{ 'Growth Opportunities' if locale == 'en' else 'Oportunidades de Crecimiento' }}
        </h4>
        <ul class="space-y-3 text-sm text-slate-300">
            <li class="flex gap-2">
                <span class="text-emerald-500">•</span>
                {{ 'The "Potential Loyalists" segment (15%) has a high ticket but low frequency. Action: Replenishment
                campaign.' if locale == 'en' else 'El segmento "Potential Loyalists" (15%) tiene ticket alto pero baja
                frecuencia. Acción: Campaña de reposición.' }}
            </li>
            <li class="flex gap-2">
                <span class="text-emerald-500">•</span>
                {{ 'Champions buy every 42 days. Automate reminder at 35 days.' if locale == 'en' else 'Los "Champions"
                compran cada 42 días. Automatizar recordatorio a los 35 días.' }}
            </li>
        </ul>
    </div>
    <div class="insight-card rounded-2xl p-6">
        <h4 class="font-semibold text-rose-400 mb-4 flex items-center gap-2">
            ⚠️ {{ 'Detected Risks' if locale == 'en' else 'Riesgos Detectados' }}
        </h4>
        <ul class="space-y-3 text-sm text-slate-300">
            <li class="flex gap-2">
                <span class="text-rose-500">•</span>
                {{ 'Loss of €42K in projected revenue if the "At Risk" segment does not return in 30 days.' if locale ==
                'en' else 'Pérdida de €42K en ingresos proyectados si el segmento "At Risk" no vuelve en 30 días.' }}
            </li>
            <li class="flex gap-2">
                <span class="text-rose-500">•</span>
                {{ 'Dangerous concentration: 5% of customers generate 50% of the margin.' if locale == 'en' else
                'Concentración peligrosa: El 5% de los clientes genera el 50% del margen.' }}
            </li>
        </ul>
    </div>
</div>

<!-- CTA Launch -->
<div class="text-center pt-8">
    <a href="{{ '/en' if locale == 'en' else '' }}/api/demo/activate/ecommerce"
        class="inline-block px-10 py-4 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-bold hover:opacity-90 transition shadow-lg shadow-emerald-500/20">
        {{ 'Launch This Engine →' if locale == 'en' else 'Poner este Motor en Marcha →' }}
    </a>
    <p class="text-[10px] text-slate-500 mt-3 italic">{{ 'Activate the full dashboard with this data' if locale == 'en'
        else 'Activa el dashboard completo con estos datos' }}</p>
</div>


</main>

<!-- Explainer Modal -->
{% include 'partials/explainer_modal.html' %}
</div>
{% endblock %}