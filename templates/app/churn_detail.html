{% extends "base.html" %}

{% block title %}Tactics - Churn Insights Detail{% endblock %}

{% block head %}
<style>
    .insight-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0));
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-glow {
        text-shadow: 0 0 20px currentColor;
    }

    .danger-badge {
        background: linear-gradient(135deg, #ef4444, #dc2626);
    }
</style>
{% endblock %}

{% block body_class %}bg-gradient-to-br from-slate-900 via-indigo-950 to-slate-900 text-white{% endblock %}

{% block content %}
<div class="min-h-screen"
    x-data="{ explainerModal: { open: false, title: '', content: null, loading: false, async explain(cat, id, val) { this.loading = true; this.open = true; try { const r = await fetch('/api/explain/' + cat + '/' + id + '/quick?value=' + val + '&locale={{ locale }}'); this.content = await r.json(); this.title = this.content.metric_name; } catch(e) { this.content = { what_it_means: '{{ "
    Error loading" if locale=="en" else "Error al cargar" }}', how_calculated: '' , caveats: [] }; } this.loading=false;
    } } }">
    <!-- Header -->
    <header class="py-8 px-6 border-b border-white/10">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div
                    class="w-12 h-12 rounded-xl bg-gradient-to-br from-rose-500 to-pink-500 flex items-center justify-center text-2xl">
                    ⚠️
                </div>
                <div>
                    <h1 class="text-2xl font-bold tracking-tight">{{ 'Churn Radar: Retention' if locale == 'en' else
                        'Churn Radar: Retención' }}</h1>
                    <p class="text-slate-400 text-sm">{{ 'IBM Telco Dataset • Predictive Analytics' if locale == 'en'
                        else 'Dataset IBM Telco • Analítica Predictiva' }}</p>
                </div>
            </div>
            <a href="{{ '/en' if locale == 'en' else '' }}/app/showcase"
                class="text-sm text-indigo-400 hover:text-indigo-300 flex items-center gap-2">
                <span class="material-symbols-outlined text-sm">arrow_back</span>
                {{ 'Back to Gallery' if locale == 'en' else 'Volver a Galería' }}
            </a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-12 space-y-12">

        <!-- Accuracy Manifesto (Contextualized) -->
        <section class="insight-card rounded-2xl p-8 border border-rose-500/20 bg-rose-500/5">
            <div class="flex flex-col md:flex-row gap-8 items-center">
                <div class="flex-1">
                    <h2 class="text-xl font-bold mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5 text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        {{ 'Ground Truth Verification' if locale == 'en' else 'Prueba de Veracidad (Ground Truth)' }}
                    </h2>
                    <p class="text-slate-300 text-sm leading-relaxed">
                        {{ 'This dataset contains the actual Churn column (Yes/No). The Tactics algorithm detects 1,663
                        out of 1,869 customers who left (Recall 89%). It is a forensic precision tool to protect
                        revenue.' if locale == 'en' else 'Este dataset contiene la columna real de Churn (Sí/No). El
                        algoritmo de Tactics detecta 1,663 de cada 1,869 clientes que se fueron (Recall 89%). Es una
                        herramienta de precisión forense para proteger ingresos.' }}
                    </p>
                </div>
                <div class="bg-slate-900/50 rounded-xl p-4 border border-white/5 text-center min-w-[200px]">
                    <div class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">{{ 'Sensitivity Effectiveness
                        (Recall)' if locale == 'en' else 'Efectividad de Sensibilidad (Recall)' }}</div>
                    <div class="text-3xl font-black text-rose-400 stat-glow">89%</div>
                </div>
            </div>
        </section>

        <!-- ­ƒÆ░ BUSINESS IMPACT: Lo que esto significa para TU negocio -->
        <section
            class="insight-card rounded-2xl p-8 border-2 border-rose-500/40 bg-gradient-to-r from-rose-500/10 to-pink-500/5">
            <h2 class="text-lg font-bold mb-6 flex items-center gap-3">
                <span class="text-2xl">💰</span>
                {{ 'What This Means for Your Business' if locale == 'en' else 'Lo que Esto Significa para Tu Negocio' }}
            </h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <div class="text-5xl font-black text-rose-400 stat-glow mb-2">€142K</div>
                    <div class="text-sm text-slate-300 leading-relaxed">
                        <strong>{{ 'Annual capital at risk:' if locale == 'en' else 'Capital en riesgo anual:'
                            }}</strong>
                        {{ 'This is the revenue you will lose if the 1,869 customers in the danger zone leave without
                        intervention. The radar allows you to act before it is too late.' if locale == 'en' else 'Son
                        los ingresos que perderás si los 1,869 clientes en zona de peligro abandonan sin intervención.
                        El radar te permite actuar antes de que sea tarde.' }}
                    </div>
                </div>
                <div>
                    <div class="text-5xl font-black text-emerald-400 stat-glow mb-2">8:1</div>
                    <div class="text-sm text-slate-300 leading-relaxed">
                        <strong>{{ 'Retention ROI:' if locale == 'en' else 'ROI de retención:' }}</strong>
                        {{ 'It costs 8 times more to acquire a new customer than to retain an existing one. Every €1
                        invested in retention saves you €8 in acquisition.' if locale == 'en' else 'Cuesta 8 veces más
                        adquirir un nuevo cliente que retener uno existente. Cada €1 invertido en retención te ahorra €8
                        en adquisición.' }}
                    </div>
                </div>
            </div>
            <div class="mt-6 pt-6 border-t border-white/10 flex justify-between items-center">
                <p class="text-[11px] text-slate-500 italic">
                    {{ 'How do we detect these customers?' if locale == 'en' else '¿Cómo detectamos a estos clientes?'
                    }}
                    <button @click="explainerModal.explain('ltv', 'churn_probability', 0.7)"
                        class="text-indigo-400 underline hover:text-indigo-300">{{ 'See methodology' if locale == 'en'
                        else 'Ver metodología' }} →</button>
                </p>
            </div>
        </section>

        <!-- Metrics Grid -->
        <div class="grid md:grid-cols-3 gap-6">
            <div class="insight-card rounded-2xl p-6">
                <div class="text-sm text-slate-400 mb-2">{{ 'High Risk Customers' if locale == 'en' else 'Clientes en
                    Riesgo Alto' }}</div>
                <div class="text-4xl font-bold text-rose-400 stat-glow">1,869</div>
                <p class="text-[10px] text-slate-500 mt-2">{{ 'Churn probability over 70%' if locale == 'en' else
                    'Probabilidad de fuga superior al 70%' }}</p>
            </div>
            <div class="insight-card rounded-2xl p-6">
                <div class="text-sm text-slate-400 mb-2">{{ 'Capital at Risk (Annual)' if locale == 'en' else 'Capital
                    en Riesgo (Anual)' }}</div>
                <div class="text-4xl font-bold text-amber-400 stat-glow">€142,300</div>
                <p class="text-[10px] text-slate-500 mt-2">{{ 'Revenue threatened by customers at risk' if locale ==
                    'en' else 'Ingresos amenazados por clientes en riesgo' }}</p>
            </div>
            <div class="insight-card rounded-2xl p-6">
                <div class="text-sm text-slate-400 mb-2">{{ 'Acquire vs Retain Cost' if locale == 'en' else 'Coste Ganar
                    vs Retener' }}</div>
                <div class="text-4xl font-bold text-emerald-400 stat-glow">8:1</div>
                <p class="text-[10px] text-slate-500 mt-2">{{ 'It is 8 times more expensive to capture than retain' if
                    locale == 'en' else 'Es 8 veces más caro capturar que retener' }}</p>
            </div>
        </div>

        <!-- Predictive Factors -->
        <div class="insight-card rounded-2xl p-8">
            <h3 class="text-lg font-semibold mb-6 flex items-center gap-2">
                <span class="danger-badge text-[10px] px-2 py-1 rounded-full uppercase">{{ 'Analysis' if locale == 'en'
                    else 'Análisis' }}</span>
                {{ 'Top Churn Factors' if locale == 'en' else 'Top Factores de Fuga' }}
            </h3>
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <span class="text-slate-300">{{ 'Month-to-Month Contract' if locale == 'en' else 'Contrato Mes a
                        Mes' }}</span>
                    <div class="flex items-center gap-4">
                        <div class="w-64 h-2 bg-slate-700 rounded-full overflow-hidden">
                            <div class="w-[89%] h-full bg-rose-500"></div>
                        </div>
                        <span class="text-rose-400 text-xs font-bold">{{ 'Correlation' if locale == 'en' else
                            'Correlación' }} 89%</span>
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-slate-300">{{ 'Tenure < 6 Months' if locale=='en' else 'Antigüedad < 6 Meses'
                            }}</span>
                            <div class="flex items-center gap-4">
                                <div class="w-64 h-2 bg-slate-700 rounded-full overflow-hidden">
                                    <div class="w-[74%] h-full bg-amber-500"></div>
                                </div>
                                <span class="text-amber-400 text-xs font-bold">{{ 'Correlation' if locale == 'en' else
                                    'Correlación' }} 74%</span>
                            </div>
                </div>
                <div class="flex items-center justify-between">
                    <span class="text-slate-300">{{ 'Manual Payment Methods' if locale == 'en' else 'Métodos de Pago
                        Manuales' }}</span>
                    <div class="flex items-center gap-4">
                        <div class="w-64 h-2 bg-slate-700 rounded-full overflow-hidden">
                            <div class="w-[62%] h-full bg-yellow-500"></div>
                        </div>
                        <span class="text-yellow-400 text-xs font-bold">{{ 'Correlation' if locale == 'en' else
                            'Correlación' }} 62%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- CTA Launch -->
        <div class="text-center pt-8">
            <a href="{{ '/en' if locale == 'en' else '' }}/api/demo/activate/churn"
                class="inline-block px-10 py-4 rounded-xl bg-gradient-to-r from-rose-500 to-pink-500 text-white font-bold hover:opacity-90 transition shadow-lg shadow-rose-500/20">
                {{ 'Launch Churn Radar →' if locale == 'en' else 'Lanzar Radar de Churn →' }}
            </a>
            <p class="text-[10px] text-slate-500 mt-3 italic">{{ 'Identify customers at risk now' if locale == 'en' else
                'Identifica clientes en riesgo ahora' }}</p>
        </div>

    </main>

    <!-- Explainer Modal -->
    {% include 'partials/explainer_modal.html' %}
</div>
{% endblock %}